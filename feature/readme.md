**房價預測模型特徵工程與 MAE 變化分析**

在本次房價預測專案中，我們透過多輪特徵工程來優化模型，並記錄了每個階段的均絕對誤差（Mean Absolute Error, MAE）變化，以評估不同特徵對模型準確度的影響。以下是我們的分析與結論。

---

### **1. 初始模型（Baseline Model）**

**MAE：293 萬**  
最初的模型使用 **基本建物資訊（坪數、樓層數、房數、房屋類型...）進行預測，這些變數已經與房價有直接關聯，但仍無法有效捕捉價格變化，MAE 達 **293 萬**。

---

### **2. 新增經緯度、均價與裝潢資訊**

**MAE：138 萬（降低 155 萬）**  
我們透過 Google Maps API 轉換 **門牌地址為經緯度**，並計算每筆房屋與 **新竹科學園區的直線距離**，此外，加入 **mean price（區域均價）與 high_price_decorated（高價裝潢標記）**，使得 MAE 大幅下降到 **138 萬**。

---

### **3. 進行資料轉換（二元與 One-Hot Encoding）**

**MAE：148 萬（上升 9 萬）**  
我們嘗試將某些變數轉換為 **二元變數（如電梯有無）與 One-Hot Encoding（如都市土地使用分區）**，然而此步驟使 MAE 上升至 **148 萬**，可能是因為特徵維度增加導致噪音變多。

---

### **4. 加入區名與里名（Target Encoding）**

我們測試了不同的編碼方式，並觀察 MAE 變化：

| 方法 | MAE |
|------|------|
| One-Hot（區+里） | 144 萬 |
| One-Hot（區） | 147 萬 |
| One-Hot（里） | 130 萬 |
| Target（區+里） | 127 萬 ✅（最佳） |
| Target（里） | 147 萬 |
| Target（區） | 151 萬 |

經過測試後，最優選擇是 **Target Encoding（區+里）**，使 MAE 降至 **127 萬**。

---

### **5. 加入新特徵組合**

我們測試了幾種不同的特徵組合，以尋找最佳的預測結果：

| 特徵組合 | MAE |
|----------|------|
| 單價 * 面積 | 84 萬 |
| 里 * 區 | 135 萬 |
| 樓層 * 電梯 | 135 萬 |
| 單價 * 面積 + 里 * 區 | 73 萬 |
| 單價 * 面積 + 樓層 * 電梯 | 71 萬 ✅（最佳） |
| 里 * 區 + 樓層 * 電梯 | 134 萬 |
| 全部特徵組合 | 74 萬 |

最有效的組合是 **單價 * 面積 + 樓層 * 電梯**，將 MAE 降至 **71 萬**。

---

### **6. 進一步優化（特徵縮放、特徵選擇）**

我們對 Target Encoding 進行標準化與平滑處理，並進一步測試特徵選擇的方法：

| 方法 | MAE |
|------|------|
| Standardized Target Encoding（區+里） | 126 萬 ✅（最佳） |
| Smooth (m=5) | 129 萬 |
| Smooth (m=5) + Standardized | 129 萬 |
| Smooth (m=3) + Standardized | 129 萬 |
| Smooth (m=5) + K-Fold | 132 萬 ❌ |
| 區域加權平均房價 | 151 萬 ❌ |
| 僅保留「區」 | 151 萬 ❌ |
| 僅保留「里」 | 147 萬 ❌ |

最後我們選擇 **Standardized Target Encoding（區+里）**，使 MAE 穩定在 **126 萬**。

---

### **7. 最終調整（單價 Log 轉換）**

我們最後進行 **log(單價) 轉換**，並刪除了影響較小的 **樓層 * 電梯交互項**，保留 **里 * 區**，最終 MAE 為 **128 萬**。

經過超參數調整後，最終模型的 **MAE 進一步降至 106 萬**，並達到了 **7.2% 的百分比誤差**。

---

### **8. 為何使用 MAE？**

MAE（Mean Absolute Error）是評估迴歸模型預測誤差的重要指標，它的計算方式如下：

\[ MAE = \frac{1}{n} \sum_{i=1}^{n} |y_i - \hat{y_i}| \]

我們選擇 MAE 而非 MSE（均方誤差）或 RMSE（均方根誤差）的原因：
- **MAE 具備直覺性**，單位與原始目標變數一致，方便解讀。
- **不過度懲罰極端值**，相比 MSE 更適合處理價格數據。
- **易於比較不同特徵組合的影響**，有助於特徵工程調整。

---

### **9. 7.2% 誤差的解讀**

目前模型的百分比誤差為 **7.2%**，表示模型預測的房價與實際房價之間的平均誤差約為 7.2%。

在房價預測領域，一般而言：
- **誤差 <5%**：極佳（通常只有高維度數據與更強的特徵工程才能達成）。
- **5% - 10%**：合理範圍，適用於大多數應用場景。
- **>10%**：可能需要進一步優化模型。

因此，我們的 7.2% 誤差已達到合理範圍，但仍有優化空間，例如納入更多建案資訊、社區名稱、交易時間等變數。

透過這次特徵工程的調整，我們成功提升了模型的準確度，未來若有更多數據，仍可進一步優化預測結果！

